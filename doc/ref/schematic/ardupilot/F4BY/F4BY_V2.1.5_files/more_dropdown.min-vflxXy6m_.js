define(["require","exports","tslib","react","external/react-redux","modules/clean/previews/data/selectors","modules/clean/previews/util","modules/clean/react/file_action_button_type","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_viewer/more_dropdown/views","modules/clean/react/size_class/constants","modules/clean/file_store/utils","modules/clean/react/title_bar/overflow_menu","modules/core/browser","modules/core/i18n","modules/clean/react/file_viewer/data/actions","modules/clean/previews/util","modules/clean/react/extensions/download_intercept","modules/clean/react/extensions/data/action_creators","modules/clean/react/size_class/utils"],function(e,t,o,r,n,i,s,l,a,c,u,p,d,m,v,f,_,h,g,w,C,y,S,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),s=o.__importStar(s);var D=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=t.getStateFromRegistry(),t.onRegistryUpdate=function(){t.setState(t.getStateFromRegistry())},t.handleDownloadClick=function(e){e.preventDefault(),w.download(t.props.file);var o=t.props.setInDownloadInterceptFlow;if(t.props.extensionsConfig&&f.isBrowseFile(t.props.file)&&t.props.user&&o&&t.props.sizeClass===v.SizeClass.Large){var r=function(){o({inDownloadInterceptFlow:!0})};y.onDownloadFile(t.props.extensionsConfig,t.props.user,t.props.file.ext,r)}return a.logUserAction(c.UserAction.Download,c.UserActionContext.TitleBarMore)},t.handleRemoveLinkClick=function(e){e.preventDefault(),t.props.onRemoveShareLink&&(t.props.onRemoveShareLink(),a.logUserAction(c.UserAction.RemoveLink,c.UserActionContext.TitleBarMore))},t.handlePreviousVersionClick=function(e){if(e.preventDefault(),!t.props.user)throw new Error("User not specified");return s.redirectToVersionHistory(t.props.file,t.props.user),a.logUserAction(c.UserAction.ViewRevisions,c.UserActionContext.TitleBarMore)},t.handleSignInClick=function(e){e.preventDefault(),a.logUserAction(c.UserAction.SignIn,c.UserActionContext.TitleBarMore),h.redirect(p.getSharedLinkLoginUrl())},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.removeRegistryListener=d.moreOptionRegistry.addListener(this.onRegistryUpdate)},t.prototype.componentWillUnmount=function(){this.removeRegistryListener()},t.prototype.getStateFromRegistry=function(){var e=this.state||{registeredItems:[]};return o.__assign({},e,{registeredItems:d.moreOptionRegistry.getOptionItems()})},t.prototype.getPopoverContent=function(){var e=this.props,t=e.allowRemoveLink,o=e.isPrivate,n=e.onRemoveShareLink,i=e.renderSignIn,s=e.shareDownloadOptions,a=e.sizeClass,c=e.file,u=[],p=a===v.SizeClass.Small,d=a===v.SizeClass.Medium,f=!A.isSmallerThanLarge(a);if(o&&d&&u.push(r.default.createElement(_.PopoverOrMobileItem,{className:"more-button__share",key:"more-button__share",onSelect:this.props.onClickShareLink},l.getFileActionButtonText(l.FileActionButtonType.SHARE))),null!=n&&t&&!p&&u.push(r.default.createElement(_.PopoverOrMobileItem,{className:"more-button__remove",key:"more-button__remove",onSelect:this.handleRemoveLinkClick},l.getFileActionButtonText(l.FileActionButtonType.REMOVE_LINK))),o&&!C.isCloudDocPreview(c)&&u.push(r.default.createElement(_.PopoverOrMobileItem,{className:"more-button__download",key:"more-button__download",onSelect:this.handleDownloadClick},l.getFileActionButtonText(l.FileActionButtonType.DOWNLOAD))),s&&!C.isCloudDocPreview(c))for(var h=0,w=s;h<w.length;h++){var y=w[h];if(!y.isDisabled){var S="more-button-sl__"+y.userAction;u.push(r.default.createElement(I,{handler:y.handler,key:S,text:y.text,userAction:y.userAction}))}}if(o&&!p&&u.push(r.default.createElement(_.PopoverOrMobileItem,{className:"more-button__version-history",key:"more-button__version-history",onSelect:this.handlePreviousVersionClick},l.getFileActionButtonText(l.FileActionButtonType.PREVIOUS_VERSIONS))),f&&!C.isCloudDocPreview(c)){var D=m.getPopoverOrMobileItemsForMoreOptions(this.state.registeredItems);u=u.concat(D)}return i&&u.push(r.default.createElement(_.PopoverOrMobileItem,{className:"more-button__sign-in",key:"more-button__sign-in",onSelect:this.handleSignInClick},C.isCloudDocPreview(c)?g._("Edit now"):g._("Sign in"))),u},t.prototype.render=function(){var e=this.props,t=e.file,o=e.direction;return r.default.createElement(_.OverflowMenu,{contentWrapperClassName:"react-file-viewer-dropdown",hideOnDisabled:C.isCloudDocPreview(t),direction:o},this.getPopoverContent())},t})(r.default.Component);t._MoreDropdown=D;var k=function(e){var t=u.getActiveFile(e);return{isFileRendered:u.getRenderStatusForCurrentFile(e)===c.PreviewRenderStatus.Succeeded,previewApiData:i.getApiDataForFile(e,t)}},b=n.connect(k,{setInDownloadInterceptFlow:S.setInDownloadInterceptFlow})(D);t.MoreDropdown=b;var I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){var e=t.props,o=e.handler,r=e.userAction;a.logUserAction(r,c.UserActionContext.TitleBarMore),o()},t}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.text;return r.default.createElement(_.PopoverOrMobileItem,{onSelect:this.handleClick},e)},t})(r.default.PureComponent)});
//# sourceMappingURL=more_dropdown.min.js-vflZfqfzS.map